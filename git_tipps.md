{{Clipboard.png}}‚Ä‚Ä‚Ä‚Ä‚Ä‚Ä‚Ä

<<TableOfContents>>¬†

=== Windows won't resolve long paths ===
{{{
git config core.longpaths true
}}}
=== I made a bad commit to my local (not push-ed it yet) ===
{{{
git reset --hard COMMIT_HASH_OF_LAST_GOOD_COMMIT
}}}

Using --soft keeps the files as they are.

Instead of the hash you can use

{{{
HEAD@{1} or HEAD^ or HEAD~1
}}}

where the number (or the number of ^) tells how many before the last.

=== renaming local branch ===

When you want to preserve your local branch, do this:

rename your local branch:

{{{
git branch -m fix-pack-LPP-3868 fix-pack-LPP-3868_LPE-7034
}}}

delete the renamed branch on origin:

{{{
git push origin :fix-pack-LPP-3868
}}}
=== How can I push a branch with another name? ===

Push your branch with a different name without changing the local branch name.

{{{
git push origin HEAD:remote-name
}}}
=== GIT always ask my username/password for github.com ===

[[http://stackoverflow.com/questions/6031214/git-how-to-use-netrc-file-on-windows-to-save-user-and-password]]

1. create a ‚Äú_netrc‚Äù file in directory where your .gitconfig is (usually C:~\Users~\your login name)

2. the content will be this:

{{{
machine github.com

login your_github_login_name

password your_password_on_github.com
}}}
=== How can I see how a file changed in time? ===
{{{
$gitk filename

$git log -- [filename]

$git log --follow -p file : entire history of the file (including history beyond renames and with diffs for each change).
}}}
=== How can I pull another engineer branch? ===
{{{
$ git fetch [[https://github.com/zsoltbalogh/liferay-portal-ee.git]] fp-LPP-3425:fp-LPP-3425
}}}
=== Git log with relative commit dates ===

When trunk does not start and you need to revert it:

{{{
$ git log --pretty=format:‚Äô%C(yellow)%h%Creset%C(cyan)%C(bold)%d%Creset%C(cyan)(%cr)%Creset %C(green)%ce%Creset %s\‚Äô
}}}
=== How can I modify my last commit message? ===
{{{
$ git commit --amend -m "New commit message"
}}}
=== How to delete a branch? ===

in local:

{{{
git branch -D BRANCH_NAME
}}}

then on origin:

{{{
git push origin :BRANCH_NAME
}}}
=== How can I delete one of my commits? ===
{{{
git checkout your_branch

git rebase -i fix-pack-base-6120
}}}

Now you will get a list of your commits (after fix-pack-base-6120)

Delete the commit from the listWindows

Save

git rebase will do what you wanted

=== How can I cherry-pick multiple commits? ===
{{{
git cherry-pick A..B
}}}

~* where A and B commit hashes and A older than B

~* This will not cheery-pick A, but commits between (A,B~]

~* to cherry-pick A also, use git cherry-pick A^..B

=== Temporary changes (git stash) ===

Let us assume, that you forgot to switch to your new branch (LPS-29619) and made changes on local master:

Borkuti Peter@BPETER-E6520 ~/c~/_repo~/liferay-portal (master)

$ git status

{{{
# On branch master
# Changes not staged for commit:
#   (use "git add <file>..." to upWindowsdate what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)#
#       modified:   portal-impl/src/com/liferay/portlet/documentlibrary/action/FindFolderAction.java~
#no changes added to commit (use "git add" and/or "git commit -a")
}}}

Use git stash for saving your work and clean your repo:

$ git stash

Now your master is clean. Switch to your branch:

$ git branch LPS-29619

List your stashes:

$ git stash list

stash@{0}: WIP on master: 980e5e4 LPS-28162 Fix compile error

stash@{1}: WIP on (no branch): 32c855d Javadocs

stash@{2}: WIP on master: c1e76cf LPS-28776 Autogenerated

Check your last stash:

$ git stash show stash@{0}

...~/com~/liferay~/portlet~/documentlibrary~/action~/FindFolderAction.java | 2 +-

1 file changed, 1 insertion(+), 1 deletion(-)

Aplly your last stash to the active branch:

$ git stash pop stash@{0}

{{{
# On branch LPS-29691
# Changes not staged for commit:
#   (use "git add <file>..." to update what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)#
#       modified:   portal-impl/src/com/liferay/portlet/documentlibrary/action/FindFolderAction.java#no changes added to commit (use "git add" and/or "git commit -a")Dropped stash@{0} (6f618b528eb5cf6e5812454ed7564eea6f8cd69b)
}}}
=== Applying patch with git ===
{{{
git am (see git am -help)
}}}
=== Flattening git commits into one ===

You want to make only one commit instead of your last 2 commits:

{{{
git rebase -i HEAD2
}}}

And (if you have gitextensions) an editor will come up.

{{{
pick ‚Ä¶. commit message

pick ‚Ä¶.. commit message
}}}

Change the word ‚Äòpick‚Äô in the second lineWindows to ‚Äòf‚Äô.

=== Shows a file from a commit (whatever branch is this on) ===
{{{
$ git show c99706fe2126f4fd59a091b9a83380492860286f:portal-impl/src/com/liferay/portlet/journal/lar/JournalPortletDataHandlerImpl.java
}}}
=== Get a file from another branch ===
{{{
$ git checkout c99706fe2126f4fd59a091b9a83380492860286f portal-impl/src/com/liferay/portlet/journal/lar/JournalPortletDataHandlerImpl.java
}}}
=== Search a line change ===
{{{
git log -S "important phrase" -p -- <file>
}}}

example:

{{{
$ git log -S 'serviceContext.getPlid() > 0' -p -- UserLocalServiceImpl.java
}}}
=== Delete a file from the last commit ===

Remove the file:

{{{
git rm <file>
}}}

Commit with amend flag:

{{{
git commit --amend
}}}
=== Unmodify a modified file ===
{{{
Windows$ git checkout <file>
}}}
=== Modify an older/previous commit ===

You can use git rebase, for example, if you want to modify back to commit bbc643cd, run

{{{
$ git rebase --interactive bbc643cd^
}}}

In the default editor, modify 'pick' to 'edit' in the line whose commit you want to modify. Make your changes and then stage them with

{{{
$ git add <filepattern>
}}}

Now you can use

{{{
$ git commit --amend
}}}

to modify the commit, and after that

{{{
$ git rebase --continue
}}}

to return back to the previous head commit.

=== Searching for a commit-date ===
{{{
git log does not show commit-dates. Use

git log --pretty=fuller
}}}
=== Reduce the size of a loWindowsng running local repo ===
{{{
git reflog expire --expire=now --all

git repack -a -d --depth=500 --window=1000 -f
}}}

(Decreased the size of my local liferay-portal-ee repo from 21 to 7.5 GB)

=== Fetch only one tag instead of all of them ===
{{{
git fetch [repository] --no-tags tags/[remote_tag_name]:tags/[local_tag_name]
}}}

For example:

//git fetch upstream --no-tags tags/fix-pack-fix-35527411:tags/portal-109//

////Create a branch from a tag

{{{
git checkout -b [branch] [tag]
}}}
=== If my build fails and I see¬†java.io.IOException in the log ===

Try the following commands:

{{{
git status

git reset --hard

git clean -fd

cd .gradle

git status

git clean -fxd

cd ..

ant all

}}}
=== I have multiple GitHub accounts ===

Taken from [[https://code.tutsplus.com/tutorials/quick-tip-how-to-work-with-github-and-multiple-accounts--net-22574|here]].

Generate ssh keys for your accounts, be sure to save them to seperate files when prompted.

{{{
ssh-keygen -t rsa -C "[account_email_address]"
}}}

Save to

{{{
/.ssh/id_rsa_[account_name]
}}}

Login to github and add your public key.

Create a config file to handle the different identities:

{{{
~/.ssh/config
}}}

The contents are:

{{{
#Default GitHub
Host github.com
HostName github.comWindows
User [company_github_account_name]
IdentityFile ~/.ssh/id_rsa

#Personal GitHub
Host github-[personal_account_name]
HostName github.com
User [personal_account_name]
IdentityFile ~/.ssh/id_rsa_[personal_account_name]
}}}

The default account will be your company account (chances are you have already set up your ssh key and stuff by the time you read this).

Now whenever you clone your personal repos or when you set up the remote (origin) address, use github-~[personal_account_name~] as the hostname.

{{{
git@github-[personal_account_name]:[personal_account_name]/[repo_name].git
}}}

You may also want to change your user.email and user.name in your local repo if you don't want to use the global settings.

=== When Github does not accept huge deltaset ===

Linux

{{{
for i in `seq 50 1`; do git push origin HEAD~${i}000:refs/remotes/master; done
}}}

Windows

{{{
FOR ~/L %%i IN (50, -1, 1) DO git push origin HEAD~%%i000:refs/remotes/master
}}}

Source: [[https://loop.liferay.com/home/-/loop/feed/2100776]]

However, it probably better to use [[https://grow.liferay.com/people/OriginAl|OriginAI]]

=== How to display the current branch name in your prompt on Linux ===

You need to edit your **bash profile** (.bashrc in your user home root). Find the code below and update to look like this:

{{{
if [ "$color_prompt" = yes ]; then
   #PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ ' # Original PS1

    PS1="${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[01;33m\]\$(git branch 2>/dev/null | grep -e '\* ' | sed 's/^..\(.*\)/{\1}/')\[\033[00m\]\$ "
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
}}}

Restart your terminal sessions to take effect.

=== How can I delete unwanted tags? ===

If you initialized your repository from one of the archives in mirrors, or you fetch tags without --no-tags, your repo could be full of unwanted tags which slows down your repo.

Run this script (which keeps all tags starting with "fix-pack-base" but deletes all others), which works in git-bash also:

{{{
git tag | grep -v fix-pack-base | xargs git tag -d
}}}

If you've pushed up hundreds of tags to your remote repository (such as origin)¬†and you'd like to remove them all, you can clear all tags from a remote repository¬†with the following script. Just change origin to the name of the remote:

{{{
git ls-remote origin | grep -F 'refs/tags/' | awk '{ print ":" $2}' | xargs git push origin
}}}
=== Keeping your remote¬†origins¬†up-to-date with OriginAI ===

Keeping the maintenance branches in the¬†origin¬†of the forked repositories updated is a task that you need to do day-by-day if you reviewing pull requests regularly.¬†

Why is it so important?

*When you get a pull request and your base branch is outdated, you will end up seeing a commit range on the GitHub UI which are not strictly belongs to the actual pull request but to the sender's updated base branch. So your only choice to see the full diff in one piece to fetch the branch and check on your local favorite git GUI tool (gitk, Git Extensions).¬†

Fortunately, [[https://grow.liferay.com/share/OriginAl|OriginAl¬†]] is a service which can do¬†this regular maintenance task for you. ¬†For the details please check¬†[[https://grow.liferay.com/share/OriginAl]]

=== Cherry-pick editing in terminal ===

It happens that you have to edit a cherry-pick but you don't want to do it in Git Extensions. With the following commands you can edit the staged files.

{{{
git cherry-pick --edit <hash>
git status
... editing: git rm / git add <filename>
git status
git cherry-pick continue
}}}
=== How to clean the repository by preserving certain files ===

Sometimes, one way to fix a build error is to do a "hard clean" on the repository which means you want remove every untracked files which are not under version control including the ignored ones also. While this can help in may cases, it has an obvious side effect: it can also remove files which you need for example:

*//**app.server.XXX.properties**//
*//**build.XXX.properties**//
*//**portal-test-ext.properties**//
*IDE-specific project files: as of 7.0, such files (//**.classpath**// and //**.project**// for Eclipse, //**.idea**// for IntelliJ) are not under version control for Gradle projects (everything under the //**modules**// folder in a Liferay Workspace)

To preserve them, you ca run the //**git clean**// command with the //**-e**// option and enlist the files you want to exclude from removal, like this:

{{{
git clean -fdx -e .classpath -e project -e .idea -e *.iml -e app.server.*.properties -e build.*.properties -e portal-test-ext.properties
}}}

TBA

=== How to checkout multiple branches from the same repository ===

**Why would you need to have multiple branches checked out?**

Switching between branches takes time, and you may need to run {{{ git reset }}} and {{{ git clean }}} before and after the checkout. Then you realize that you just deleted your work.

So normally you would clone the repository multiple times and check out a different branch in each repository, right? WRONG!

The liferay repository is really big and takes a lot of time to clone it. Even copy-pasting the files can take tremendously long, because of the size and number of files involved. The .git folder is alone >10GB and the files in master can take >2GB.

**The solution: git worktree**

[[https://git-scm.com/docs/git-worktree]]

Create a directory for each branch you need. The folder structure can look like this:

{{{
github/
    liferay-portal-ee/
        .git/
        modules/
        ...
    liferay-portal-ee-master/
    liferay-portal-ee-ee-7.0.x/
    liferay-portal-ee-ee-6.2.x/
    ...
    
}}}

In command line {{{ cd }}} into your git repository (liferay-portal-ee) and run 

{{{
    git worktree add [branch-folder-path] [branch-name]
}}}

So in this case you would run 

{{{
git worktree add ../liferay-portal-ee-master master 
}}}

Git commands will run normally in the new branches.

**Updating the branches**

You can go into the folder and run 

{{{
git pull upstream [branch-name] 
}}}

An interesting thing happens when you run the following from the git repository

{{{
git fetch upstream [branch-name]:[branch-name] 
}}}

This will result in the commits of the branch being updated, but the files don't change. You can resolve this by running {{{ git reset }}} in the branch folder.

=== How to Clone Only One Branch ===
{{{
git clone git@github.com:[user]/[repository].git --branch [branchName] --single-branch
}}}
=== How to Make git fetch retrieve fewer branches ===

This requires a newer version of git (such as 2.10.x), but you can use [[https://git-scm.com/docs/git-remote#git-remote-emset-branchesem|set-branches]] to limit the branches that are tracked, which will make it so that {{{git fetch}}} only retrieves those branches, ignoring newer review branches that may be pushed to master for things like subrepository merges (this does not help with tags, though):

{{{
git remote upstream set-branches master master-private 7.0.x 7.0.x-private ee-6.2.x ee-6.1.x ee-6.0.x
git fetch upstream --no-tags
}}}
=== Finding when part of a line of code was added/removed ===

If a simple "git blame" wouldn't get the desired result, you can use the True Blame script to avoid having to hunt through GitHub for it. It can be used either from the command line, or set up as an External Tool in an IDE like IntelliJ.

You can find True Blame with basic documentation¬†at¬†[[https://github.com/liferay/liferay-support-ee/tree/master/scripts/true-blame]] -- or, for more info on True Blame, see¬†[[https://grow.liferay.com/people/True+Blame+script]]

=== Liferay: Enable Testing Your Pull Requests ===

See [[https://in.liferay.com/web/global.engineering/blog/-/blogs/14292996|Test Your Pull Requests.]]

=== Liferay: CI liferay-continuous-integration GitHub Commands ===

See [[https://grow.liferay.com/share/ci+liferay-continuous-integration+github+commands|CI liferay-continuous-integration GitHub Commands]]

=== How to cherry-pick When File Locations are Different (Backport) ===

It happens the source gets restructured in newer branches, so you when want to backport a change cherry-pink may not be working. Git is able to follow renames but it has a limit. The limit can be configured, but it requires O(n^2) processing time.\\See:

*//git config merge.renameLimit and diff.renameLimit//
*[[https://stackoverflow.com/questions/4722423/how-to-merge-two-branches-with-different-directory-hierarchies-in-git?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa]]
*[[https://www.atlassian.com/blog/archives/confluence_git_rename_merge_oh_my]]
*[[http://www.brettallred.com/blog/2012/02/18/you-may-want-to-set-your-merge-renamelimit-git]]

Credit goes to Jorge D. Original [[https://loop.liferay.com/home/-/loop/feed/11511811|post]].\\There is a [[https://grow.liferay.com/share/Backport+from+master+to+ee-6.2.x|detailed article]] about it on grow + a script

